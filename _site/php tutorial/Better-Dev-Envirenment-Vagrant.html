<!DOCTYPE html>
<html>
  <head>
  
	<script type="text/javascript" src="http://tajs.qq.com/stats?sId=62637431" charset="UTF-8"></script>
				
      
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/php%20tutorial/Better-Dev-Envirenment-Vagrant.html">
  <link rel="alternate" type="application/rss+xml" title="LiamHsia's Blog" href="http://localhost:4000/feed.xml">

<!-- Google font -->

  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto Sans">

<!-- font awesome -->

<link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">

</head>


  

  

  </head>

  <body>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>更好的PHP开发环境-Vagrant篇</title>
  <meta name="description" content="还记得，我们第一次学PHP是干嘛么？我想大部人都是从安装PHP运行环境开始的吧。  学习PHP第一步，就要先理解PHP的运行环境 – 韩老师">
</head>


  <div class="wrapper">
          <header class="post-header">

<script type="text/javascript" src="http://tajs.qq.com/stats?sId=62637431" charset="UTF-8"></script>
				
    <center><div class="post-title" itemprop="name headline">更好的PHP开发环境-Vagrant篇</div>

		<div class="post-meta"><i class="fa fa-calendar-o"></i> <time datetime="01 Jun 2017" itemprop="datePublished">Jun 1 2017</time>

		&nbsp;&nbsp;•&nbsp;&nbsp;<i class="fa fa-user-secret"></i> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">LiamHsia</span>
        
		<br>
		<i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-pulse"></i></span>˚C</span>
	</div>

        
        <div class="post-tags">
        
		<a class="post-tags-item" href="http://localhost:4000/tags/">PHP</a>
        
		<a class="post-tags-item" href="http://localhost:4000/tags/">开发环境</a>
        
	</div>
    </center>
    
</header>

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<div class="post-content">
    <center>
	
	<p>装开发环境就想搬家，重新布置房间可真让人不爽啊</p>
	
    </center>
</div>

<div id="category"></div>

<div class="post-content" itemprop="articleBody">
	<p>还记得，我们第一次学PHP是干嘛么？我想大部人都是从安装PHP运行环境开始的吧。</p>
<blockquote>
  <p>学习PHP第一步，就要先理解PHP的运行环境 – 韩老师</p>
</blockquote>

<p>然后就开始哼哧哼哧地开始在Windows上安装环境，先PHP，然后Apache，再装MySQL，从安装到最后调试通，足足花了一周。</p>

<p>后来，我们也明白，Apache是干嘛的，流量是怎么交给PHP处理的，就别这么费劲一步一步装了，来一套集成的安装环境，<a href="http://www.wampserver.com/en/">WampServer</a> 成了最好的选择。</p>

<p><img src="http://ooyc2y4k2.bkt.clouddn.com/UE7k3" alt="Wampserver 官网截图" /></p>

<p>好学而且有好奇心的我们，成长的总是那么快，很快我们便知道有一种操作系统比Windows更适合开发，有一种服务器比Apache更优秀，便开始在Linux上安装LNMP架构的环境，大学实验室里那几台电脑，被我们装了又装，Linux发行版也换了好几茬，然后就毕业了，第一天上班就是要装开发环境，你得用QQ和PHPStorm，不能在那么优秀的操作系统上开发了，无奈换回了WampServer，冷气吹得你发冷和难受，你开始怀念那段大学不受拘束的时光，和实验室那几台LNMP架构的开发环境。</p>

<p><img src="http://ooyc2y4k2.bkt.clouddn.com/K7nJ6" alt="Vagrant" /></p>

<p>时光一去不复返，但我们即可以使用QQ和PHPStorm，同时也能使用我们心爱的LNMP环境开发了，就是我们今天的主角：<a href="https://www.vagrantup.com/">Vagrant</a>。</p>

<h2 id="vagrant-是什么--可以做什么">Vagrant 是什么 &amp; 可以做什么</h2>
<p>Vagrant是一套对虚拟系统进行配置，管理，分发的一套系统，依赖虚拟机环境，比如Virtualbox和VMWare。</p>

<p>这和直接使用Virtualbox等虚拟机软件有什么不同呢？本质上是没有什么不同的，Vagrant只是一套工具，我们可以更加方便配置，和使用这个虚拟机，想想一条命令就能保存现运行的虚拟环境，远比你去拷贝虚拟机文件简单地多吧。</p>

<h2 id="安装">安装</h2>
<p>在<a href="https://www.vagrantup.com/downloads.html">下载页面</a>，选择你的操作系统对应的版本，然后安装。</p>

<p>安装完毕，尝试在终端中输入：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant --version
</code></pre></div></div>
<p>此外还需要安装Virtualbox或者VMWare，Virtualbox开源且免费，默认我选择此虚拟机，可以在 <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a> 选择合适的版本。</p>
<h2 id="选择合适的镜像">选择合适的镜像</h2>
<p>我们把镜像称之为box，添加一个镜像也很简单。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant box add centos/7
</code></pre></div></div>
<p>很简单就添加了centos7的开发镜像，当然你还可以选择其他的镜像，在 <a href="https://atlas.hashicorp.com/boxes/search">https://atlas.hashicorp.com/boxes/search</a> 选择适合你的。</p>

<p>由于国内网络的原因，直接使用<code class="highlighter-rouge">add</code>命名，下载镜像的速度实在太慢(Fuck GFW)，我们不妨事先下载好镜像，然后再<code class="highlighter-rouge">add</code>进去，我们在 <a href="http://www.vagrantbox.es/">http://www.vagrantbox.es/</a>选择和下载镜像。</p>

<p>我们下载好镜像，放在目录下，执行：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant box add [名称] [镜像地址]
</code></pre></div></div>
<p><img src="http://ooyc2y4k2.bkt.clouddn.com/udvKh" alt="Untitled Image" /></p>

<p>我们再运行<code class="highlighter-rouge">vagrant box list</code>命令，便能看到一个名为server的镜像。</p>

<p><img src="http://ooyc2y4k2.bkt.clouddn.com/n5J5G" alt="Untitled Image" /></p>

<h2 id="启动开发环境">启动开发环境</h2>
<p>首先要初始化此开发环境，在任意文件夹下执行：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant init [镜像名称]
</code></pre></div></div>
<p><img src="http://ooyc2y4k2.bkt.clouddn.com/llgLq" alt="Untitled Image" /></p>

<p>初始化完成之后，会在当前文件夹下创建一个<code class="highlighter-rouge">Vagrantfile</code>的配置文件，至于有哪些配置项，先放在一边，先启动我们的开发镜像，在<strong>此文件夹</strong>下执行：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant up
</code></pre></div></div>
<p><img src="http://ooyc2y4k2.bkt.clouddn.com/6BHhy" alt="Untitled Image" /></p>

<p>成功启动，如果你打开Virtualbox，还可以发现vagrant镜像正在运行。
<img src="http://ooyc2y4k2.bkt.clouddn.com/39erQ" alt="Untitled Image" /></p>

<p>通过SSH来连接开发环境，如果你是Mac或Linux用户，可以直接用命令<code class="highlighter-rouge">vagrant ssh</code>来连接。</p>

<p><img src="http://ooyc2y4k2.bkt.clouddn.com/fp2La" alt="Untitled Image" /></p>

<p>由于Windows原生不支持SSH，使用<code class="highlighter-rouge">vagrant ssh-config</code>来取得SSH配置，用第三方的SSH软件来连接。</p>

<p>连接上我们的开发环境，执行命令：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; uname -a 
</code></pre></div></div>
<p><img src="http://ooyc2y4k2.bkt.clouddn.com/ApRkM" alt="Untitled Image" /></p>

<p>wow，熟悉的Linux系统又回来了，我啰啰嗦嗦写了这么多，其实简单几步就创建好了一个开发环境，你现在便可以在本地用着QQ，而在开发环境装LNMP，进行开发工作了。</p>

<h2 id="配置">配置</h2>
<p>只是搭建好了开发环境，还是不够，还需要有共享文件夹，把本地网络和开发环境网络调通，以便我们后续的开发和调试。</p>

<h3 id="共享文件夹配置">共享文件夹配置</h3>
<p>打开<code class="highlighter-rouge">Vagrantfile</code>，在42至46行告诉我们，共享文件夹是在这里配置，第一个配置参数是本地目录，第二个参数是开发环境要同步的目录。在本地新建<code class="highlighter-rouge">code/</code>文件夹，并且在开发环境新建文件夹<code class="highlighter-rouge">/home/code</code>，想要本地和开发环境共享文件，便可以这么写：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>config.vm.synced_folder "./code", "/home/code"
</code></pre></div></div>
<p>取消该行代码的注释，保存，<code class="highlighter-rouge">vagrant reload</code> 命令重新启动虚拟机。</p>

<p><img src="http://ooyc2y4k2.bkt.clouddn.com/BC4Dn" alt="文件挂载成功" /></p>

<p>挂载共享文件夹成功，在本地code文件夹新建一个文件试试吧，开发环境的code文件夹下也一定有该文件了，awesome！</p>

<h3 id="网络配置">网络配置</h3>
<p>本地和开发开发环境网络连接共有三种方式</p>
<ol>
  <li>端口转发：将指定端口的网络转接到开发环境</li>
  <li>公开网络：将所有网络转接到开发环境，是一种桥接</li>
  <li>私有网络：将指定IP的网络转接到开发环境</li>
</ol>

<p>我比较偏向于第三种私有网络的方式，修改配置文件：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>config.vm.network "private_network", ip: "192.168.33.10"
</code></pre></div></div>
<p>保存，<code class="highlighter-rouge">vagrant reload</code>命令重启虚拟机。如果你已经装完Nginx，直接访问<code class="highlighter-rouge">192.168.33.10</code>即可看到成功页面了。出现拒绝访问的话，关闭开发环境的防火墙即可。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl disable firewalld
</code></pre></div></div>

<p><img src="http://ooyc2y4k2.bkt.clouddn.com/TRWMT" alt="Nginx成功页面" /></p>

<h2 id="备份和分发">备份和分发</h2>
<p>你安装完LNMP环境，甚至还装了Redis和Python，作为开发环境用得很是顺畅，旁边的小张也受够了WampServer这种不专业的东西，但他懒到都不愿意花半个小时读一下这篇文章，仅仅想要你的开发环境。</p>

<p>大可不用去拷贝虚拟机文件，Vagrant为我们准备好了备份的工具。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant package
</code></pre></div></div>
<p>vagrant会将我们现在运行的开发环境打包成一个新的box，此镜像包含我们已经安装的所有的东西，再把Vagrantfile拷贝过去，两条命令就可以重现当前的开发环境，</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant box add server package.box
&gt; vagrant up
</code></pre></div></div>
<p>BOOM！你的开发环境完整的就移植过去了。此方法也可以用作你开发系统的备份，想要一份祖传的开发环境？打包一份传到网盘，随时随地任何机器都可以使用。</p>

	<hr>
	<p>If You Have <b>Any</b> Question, You Can Contact Me Through <a href="mailto:liam@blue7wings.com">liam@blue7wings.com</a>, <a href="https://weibo.com/blue7wings">@Blue7Wings</a>, <a href="https://twitter.com/Liam_Hsia">#Liam_Hsia</a></p>
</div>

<div>
	
	<div class="eof"></div>
	
</div>

<div class="share">
    <p>Share this post with: </p>
	<a href="https://twitter.com/intent/tweet?text=更好的PHP开发环境-Vagrant篇@Liam_Hsia&amp;url=http://localhost:4000/php%20tutorial/Better-Dev-Envirenment-Vagrant.html" class="twitter-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
		</span>
	</a>
    
	<a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/php%20tutorial/Better-Dev-Envirenment-Vagrant.html" class="facebook-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
		</span>
	</a>
    
	<a href="https://plus.google.com/share?url=http://localhost:4000/php%20tutorial/Better-Dev-Envirenment-Vagrant.html" class="googleplus-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
		</span>
	</a>
</div>


<div id="disqus_thread"></div>


<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "http://localhost:4000/php%20tutorial/Better-Dev-Envirenment-Vagrant.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/php%20tutorial/Better-Dev-Envirenment-Vagrant"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://liam-hsia.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> 



</article>

  </div>

</body>

<foot>

    <footer class="site-footer">

  <div class="wrapper">

    <center>
        
		<p><a class="link" href="/archive/">Archive</a> /
		<a class="link" href="/category/">Category</a> / 
		<a class="link" href="/tags/">Tags</a> / 
		<a class="link" href="/about/">About</a> 
		<!-- <a class="link" href="/contact/">Contact</a> -->
        </p>

        <span><script>document.write(new Date().getFullYear());</script></span>
        <span>&copy;</span>
        
		<a class="link" href="">LiamHsia</a>

    </center>
    
  </div>

</footer>

    <foot>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Derictory -->

  <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
  <script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>

<!-- Hit analytics -->

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- Directory -->

<script src="/js/main.js"></script>

</foot>


</foot>

</html>
